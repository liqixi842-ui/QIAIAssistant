# åŠ¨ã€ŒQIã€æ¥ CRM - å¿«é€Ÿéƒ¨ç½²å‘½ä»¤å‚è€ƒ

## ğŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬

å¤åˆ¶ä»¥ä¸‹å‘½ä»¤ï¼Œç²˜è´´åˆ°æœåŠ¡å™¨ç»ˆç«¯ï¼Œä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰éƒ¨ç½²æ­¥éª¤ï¼š

```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@172.93.32.222

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/dongqilai-crm

# å¤‡ä»½æ•°æ®åº“
mkdir -p backups && pg_dump -U postgres dongqilai_db > backups/backup_$(date +%Y%m%d_%H%M%S).sql

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…ä¾èµ–
npm install

# æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆåªä¿ç•™qixiè´¦å·ï¼‰
npm run tsx server/clean-test-data.ts

# åŒæ­¥æ•°æ®åº“
npm run db:push

# é‡å¯åº”ç”¨
pm2 restart dongqilai-crm

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs dongqilai-crm --lines 30
```

---

## ğŸ“ åˆ†æ­¥å‘½ä»¤ï¼ˆæ¨èæ–°æ‰‹ï¼‰

### 1. è¿æ¥æœåŠ¡å™¨
```bash
ssh root@172.93.32.222
```

### 2. è¿›å…¥é¡¹ç›®
```bash
cd /root/dongqilai-crm
```

### 3. å¤‡ä»½æ•°æ®åº“ â­
```bash
mkdir -p backups
pg_dump -U postgres dongqilai_db > backups/backup_$(date +%Y%m%d_%H%M%S).sql
```

### 4. æ‹‰å–ä»£ç 
```bash
git pull origin main
```

### 5. å®‰è£…ä¾èµ–
```bash
npm install
```

### 6. æ¸…ç†æµ‹è¯•æ•°æ® ğŸ§¹
```bash
npm run tsx server/clean-test-data.ts
```
**è¿™ä¼šåˆ é™¤æ‰€æœ‰å®¢æˆ·å’Œæµ‹è¯•ç”¨æˆ·ï¼Œåªä¿ç•™qixiä¸»ç®¡è´¦å·**

### 7. åŒæ­¥æ•°æ®åº“
```bash
npm run db:push
```

### 8. é‡å¯åº”ç”¨
```bash
pm2 restart dongqilai-crm
```

### 9. æ£€æŸ¥çŠ¶æ€
```bash
pm2 status
pm2 logs dongqilai-crm --lines 30
```

---

## ğŸ” å¸¸ç”¨æ£€æŸ¥å‘½ä»¤

### æŸ¥çœ‹åº”ç”¨çŠ¶æ€
```bash
pm2 status
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
pm2 logs dongqilai-crm
```

### æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
```bash
pm2 logs dongqilai-crm --lines 50
```

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
pm2 logs dongqilai-crm --err --lines 50
```

### å®æ—¶ç›‘æ§
```bash
pm2 monit
```

---

## ğŸ”„ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### é‡å¯åº”ç”¨
```bash
pm2 restart dongqilai-crm
```

### åœæ­¢åº”ç”¨
```bash
pm2 stop dongqilai-crm
```

### å¯åŠ¨åº”ç”¨
```bash
pm2 start dongqilai-crm
```

### æŸ¥çœ‹åº”ç”¨è¯¦æƒ…
```bash
pm2 show dongqilai-crm
```

---

## ğŸ›  æ•…éšœæ’æŸ¥å‘½ä»¤

### é—®é¢˜ï¼šåº”ç”¨æ— æ³•å¯åŠ¨

```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs dongqilai-crm --err --lines 100

# 2. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5000

# 3. æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /root/dongqilai-crm
npm run dev
```

### é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -U postgres -d dongqilai_db

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
psql -U postgres -l | grep dongqilai
```

### é—®é¢˜ï¼šNginx 502é”™è¯¯

```bash
# æ£€æŸ¥Nginxé…ç½®
nginx -t

# é‡å¯Nginx
systemctl reload nginx

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/error.log
```

---

## ğŸ”™ å›æ»šå‘½ä»¤

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬ï¼š

```bash
# 1. æŸ¥çœ‹å†å²ç‰ˆæœ¬
git log --oneline -10

# 2. å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼ˆæ›¿æ¢ä¸ºå®é™…commit hashï¼‰
git reset --hard <commit-hash>

# 3. æ¢å¤æ•°æ®åº“ï¼ˆæ›¿æ¢ä¸ºå®é™…å¤‡ä»½æ–‡ä»¶åï¼‰
psql -U postgres dongqilai_db < backups/backup_YYYYMMDD_HHMMSS.sql

# 4. é‡æ–°å®‰è£…ä¾èµ–
npm install

# 5. é‡å¯åº”ç”¨
pm2 restart dongqilai-crm
```

---

## âœ… å¿«é€ŸéªŒè¯

è®¿é—®ï¼šhttps://app.detusts.com

ç™»å½•è´¦å·ï¼š
- ç”¨æˆ·åï¼š`qixi`
- å¯†ç ï¼š`hu626388`

æ£€æŸ¥ï¼š
- [ ] æ¬¢è¿è¯­æ˜¾ç¤ºæ­£ç¡®ï¼ˆä¸ƒå¤•æˆ–æ‚¨çš„æ˜µç§°ï¼‰
- [ ] å®¢æˆ·åˆ—è¡¨ä¸ºç©ºï¼ˆæµ‹è¯•æ•°æ®å·²æ¸…ç†ï¼‰
- [ ] å¯ä»¥æ·»åŠ æ–°å®¢æˆ·
- [ ] AIåŠŸèƒ½æ­£å¸¸
- [ ] å›¢é˜Ÿç¾¤èŠå®æ—¶é€šä¿¡
- [ ] æ ‡ç­¾é¢œè‰²æ­£ç¡®

---

## ğŸ’¡ æç¤º

1. **æ¯æ¬¡éƒ¨ç½²å‰éƒ½è¦å¤‡ä»½æ•°æ®åº“**
2. **æ¸…ç†è„šæœ¬åªè¿è¡Œä¸€æ¬¡**ï¼ˆéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼‰
3. **è¯æœ¯åº“åˆ†ç±»**éœ€è¦åœ¨ç½‘é¡µä¸Šæ‰‹åŠ¨ç®¡ç†
4. **å¦‚æœ‰é—®é¢˜**ï¼Œå…ˆæŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs dongqilai-crm`

---

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜ï¼š

1. ç«‹å³åœæ­¢åº”ç”¨ï¼š`pm2 stop dongqilai-crm`
2. æ¢å¤æ•°æ®åº“å¤‡ä»½
3. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**æœåŠ¡å™¨**: 172.93.32.222  
**åŸŸå**: https://app.detusts.com  
**ç®¡ç†å‘˜**: qixi / hu626388
